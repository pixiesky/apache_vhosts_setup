#!/usr/bin/php

<?php
function ask($prompt) {
	echo $prompt . " :";
	return fopen ("php://stdin","r");
}

function answer($answer, $true) {
	$line = fgets($answer);
	
	if(trim($line) == $true){
    	return true;
    }
}

function line($val) {
	echo $val."/n";
}

function read_csv($filename = "data.csv") {
	return array_map('str_getcsv', file($filename));
}

//$q = ask("Am I a question? y/n");
//$reply = (answer($q, "y") ? "true" : "false");
//line($reply);

$csv = read_csv();
$fields = array_shift($csv);

$apache_templates = file_get_contents("templates/wp_vhosts_template.tmpl");
$bash_templates = file_get_contents("templates/bash-setup.tmpl");

foreach ($fields as $key => $value) {
	$fields[$key] = "{{".strtoupper($value)."}}";
}

foreach ($csv as $ckey => $cvalue) {
	$apache = str_replace($fields, $csv[$ckey], $apache_templates);
	mkdir("config_files");
	file_put_contents("config_files/" . $csv[$ckey][0] . ".conf", $apache);
	
	mkdir("scripts");
	$bash = str_replace($fields, $csv[$ckey], $template);
	file_put_contents("scripts/users", $bash, FILE_APPEND);
}	